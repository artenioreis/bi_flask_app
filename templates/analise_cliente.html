<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>BI Varejão Farma - Analise</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; }
        /* BARRA ROXA image_63ac97.png */
        .navbar { background: #6f42c1; color: white; padding: 12px 30px; display: flex; justify-content: space-between; align-items: center; }
        .navbar-brand { font-size: 18px; font-weight: 800; display: flex; align-items: center; }
        .v-tag { background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 12px; font-size: 11px; margin-left: 10px; }
        .btn-top { background: rgba(255,255,255,0.1); color: white; padding: 6px 15px; border-radius: 20px; text-decoration: none; font-size: 12px; border: 1px solid rgba(255,255,255,0.3); }
        
        /* SELECT AMARELO image_63ac97.png */
        .sel-yellow { background: #ffc107; border: none; padding: 6px 15px; border-radius: 5px; font-weight: 800; cursor: pointer; color: #333; font-size: 12px; }

        .container { max-width: 1400px; margin: 20px auto; padding: 0 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .card-full { grid-column: 1 / -1; }
        .title { color: #2c3e50; font-size: 15px; font-weight: 700; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .kpi-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .kpi-box { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #6f42c1; text-align: center; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; padding: 12px; background: #f8f9fa; border-bottom: 2px solid #eee; }
        td { padding: 12px; border-bottom: 1px solid #f0f2f5; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">BI Varejão Farma <span class="v-tag">v44.4</span></div>
        <div style="display: flex; gap: 15px; align-items: center;">
            <select class="sel-yellow" onchange="if(this.value) window.location.href='/dashboard?tipo=vendedor&valor='+this.value">
                <option value="">Vendedores ▾</option>
                {% for v in vendedores %}
                <option value="{{ v[0] }}">{{ v[1] }}</option>
                {% endfor %}
            </select>
            <a href="/dashboard" class="btn-top">← Voltar ao Dashboard</a>
            <a href="/logout" style="color: white; font-size: 12px; text-decoration: none; opacity: 0.8;">Sair</a>
        </div>
    </nav>

    <div class="container">
        <div class="card card-full" style="display: flex; justify-content: space-between; align-items: center; border-left: 6px solid #6f42c1;">
            <div><h2 style="color: #2c3e50; font-size: 26px;">{{ cliente[1] }}</h2><small style="color: #999;">Cód: {{ cliente[0] }}</small></div>
            <div style="text-align: right;">
                <div style="font-size: 12px; color: #999; font-weight: bold;">SITUAÇÃO</div>
                <div style="color: {% if dias_atraso > 0 %}#dc3545{% else %}#28a745{% endif %}; font-weight: 900; font-size: 22px;">
                    {{ "Regular" if dias_atraso == 0 else "Em Atraso" }}
                </div>
                <div style="font-size: 12px; color: #999; font-weight: bold; margin-top: 5px;">SALDO DEVEDOR</div>
                <div style="font-weight: 900; font-size: 22px;">R$ {{ "%.2f"|format(saldo) }}</div>
            </div>
        </div>

        <div class="card">
            <div class="title">Resumo Financeiro</div>
            <div class="kpi-row">
                <div class="kpi-box"><small>Limite</small><div><strong>R$ {{ "%.2f"|format(limite_credito) }}</strong></div></div>
                <div class="kpi-box" style="border-color: #28a745;"><small>Venda Mês</small><div><strong>R$ {{ "%.2f"|format(vendas_atual) }}</strong></div></div>
                <div class="kpi-box" style="border-color: #ffc107;"><small>Meta (Excel)</small><div><strong>R$ {{ "%.2f"|format(objetivo) }}</strong></div></div>
                <div class="kpi-box" style="border-color: #dc3545;"><small>Atraso</small><div><strong>{{ dias_atraso }} dias</strong></div></div>
            </div>
        </div>

        <div class="card" style="text-align: center;">
            <div class="title">Atingimento de Meta</div>
            <div style="height: 150px;"><canvas id="metaGauge"></canvas></div>
            <div style="font-size: 26px; font-weight: 900; margin-top: -20px; color: #2c3e50;">{{ "%.1f"|format((vendas_atual/objetivo*100) if objetivo > 0 else 0) }}%</div>
        </div>

        <div class="card card-full">
            <div class="title">Evolução Mensal (Comparativo Anual)</div>
            <div style="height: 320px;"><canvas id="compChart"></canvas></div>
        </div>
    </div>

    <script>
        // GRÁFICO DE LINHAS image_63ac97.png
        const hist = {{ comparativo | tojson }};
        const d24 = Array(12).fill(0), d25 = Array(12).fill(0), d26 = Array(12).fill(0);
        hist.forEach(h => { if(h.ano===2024) d24[h.mes-1]=h.total; else if(h.ano===2025) d25[h.mes-1]=h.total; else if(h.ano===2026) d26[h.mes-1]=h.total; });

        new Chart(document.getElementById('compChart'), {
            type: 'line', 
            data: {
                labels: ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
                datasets: [
                    { label: '2024', data: d24, borderColor: '#f5c6cb', backgroundColor: 'transparent', pointRadius: 4, tension: 0.3 },
                    { label: '2025', data: d25, borderColor: '#ffeeba', backgroundColor: 'transparent', pointRadius: 4, tension: 0.3 },
                    { label: '2026', data: d26, borderColor: '#c3e6cb', backgroundColor: 'transparent', pointRadius: 4, tension: 0.3 }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
        
        new Chart(document.getElementById('metaGauge'), { type: 'doughnut', data: { datasets: [{ data: [{{vendas_atual if vendas_atual<objetivo else objetivo}}, {{objetivo-vendas_atual if objetivo>vendas_atual else 0}}], backgroundColor: ['#28a745', '#eee'], circumference: 180, rotation: 270, cutout: '80%' }] }, options: { maintainAspectRatio: false, plugins: { legend: { display: false } } } });
    </script>
</body>
</html>